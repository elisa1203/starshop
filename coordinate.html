<!-- coordinate.html -->
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚³ãƒ¼ãƒ‡ã‚’ä½œã‚‹</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
    
 <h2>ã‚³ãƒ¼ãƒ‡ã‚’ä½œã‚‹</h2>
 

<div class="coordinate-wrapper">

  <!-- ã‚­ãƒ£ãƒ³ãƒã‚¹ -->
  <div id="coordinate-area"></div>
  
  <!-- ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠ -->
  <div class="item-panel">

    <div class="genre-buttons">
      <button data-genre="tops">ãƒˆãƒƒãƒ—ã‚¹</button>
      <button data-genre="bottoms">ãƒœãƒˆãƒ ã‚¹</button>
      <button data-genre="bags">ãƒãƒƒã‚°</button>
    <button data-genre="accessories">ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼</button>
    <button data-genre="shoes">ã‚·ãƒ¥ãƒ¼ã‚º</button>
    </div>

    <!-- å•†å“ãƒªã‚¹ãƒˆ -->
    <div class="item-list">

      <div class="genre-items" id="tops">
        <img src="adidas-pink-jacket.png" data-slot="top">
        <img src="green-jacket.png" data-slot="top">
       <img src="purple-border-vknit.png" data-slot="top">
      </div>

      <div class="genre-items" id="bottoms" style="display:none;">
        <img src="ribbon-flare.png" data-slot="bottom">
      </div>

      <div class="genre-items" id="bags" style="display:none;">
        <img src="camo-bag.png" data-slot="bag">
         <img src="pink-dot-bag.png" data-slot="bag">
      </div>
      
ã€€ã€€<div class="genre-items" id="accessories" style="display:none;">
        <img src="necklace-removebg-preview.png" data-slot="accessories">
         <img src="layer-egg-necklace.png" data-slot="accessories">
      </div>
      
      <div class="genre-items" id="shoes" style="display:none;">
         <img src="green-sandals.png" data-slot="shoes">
         <img src="blue-snake-sandals.png" data-slot="shoes">
        
      </div>

    </div>

  </div>
  
  </div>


   <button id="save-btn">ä¿å­˜</button>
   
 



<div class="bg-colors">
<button data-pattern="dot">ğŸ«§</button>
<button data-pattern="star">âœ©</button>
  <button data-color="#ff0000">â¤ï¸</button>
  <button data-color="#ff66b2">ğŸ©·</button>
  <button data-color="#ff9900">ğŸ§¡</button>
  <button data-color="#ffeb3b">ğŸ’›</button>
  <button data-color="#4caf50">ğŸ’š</button>
  <button data-color="#66ccff">ğŸ©µ</button>
  <button data-color="#2196f3">ğŸ’™</button>
  <button data-color="#9c27b0">ğŸ’œ</button>
  <button data-color="#000000">ğŸ–¤</button>
  <button data-color="#ffffff">ğŸ¤</button>
</div>

   <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>

/* âœ… èƒŒæ™¯è‰²ãƒœã‚¿ãƒ³ï¼ˆè‰²ã ã‘å¤‰ãˆã‚‹ï¼‰ */
document.querySelectorAll("[data-color]").forEach(btn => {
  btn.addEventListener("click", () => {
    const area = document.getElementById("coordinate-area");

    // âœ… èƒŒæ™¯è‰²ã ã‘å¤‰ãˆã‚‹ï¼ˆæŸ„ã¯æ¶ˆã•ãªã„ï¼‰
    area.style.backgroundColor = btn.getAttribute("data-color");
  });
});

/* âœ… ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒœã‚¿ãƒ³ï¼ˆæŸ„ã ã‘å¤‰ãˆã‚‹ï¼‰ */
document.querySelectorAll("[data-pattern]").forEach(btn => {
  btn.addEventListener("click", () => {
    const area = document.getElementById("coordinate-area");
    const pattern = btn.getAttribute("data-pattern");

    // âœ… æŸ„ã ã‘åˆ‡ã‚Šæ›¿ãˆã‚‹ï¼ˆèƒŒæ™¯è‰²ã¯æ®‹ã™ï¼‰
    area.classList.remove("bg-dot", "bg-star");

    if (pattern === "dot") area.classList.add("bg-dot");
    if (pattern === "star") area.classList.add("bg-star");
  });
});

/* âœ… ä¿å­˜æ©Ÿèƒ½ï¼ˆèƒŒæ™¯è‰²ï¼‹æŸ„ã‚’ãã®ã¾ã¾ä¿å­˜ï¼‰ */
document.getElementById("save-btn").addEventListener("click", function() {
  const target = document.getElementById("coordinate-area");

  // âœ… UIã‚’éš ã™ï¼ˆå‰Šé™¤ãƒœã‚¿ãƒ³ãƒ»ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«ï¼‰
  const uiButtons = document.querySelectorAll(".delete-btn, .resize-handle");
  uiButtons.forEach(btn => btn.classList.add("hide-ui"));

  html2canvas(target, {
    scale: 2,
    backgroundColor: null,  // âœ… èƒŒæ™¯è‰²ï¼‹æŸ„ã‚’ãã®ã¾ã¾ä¿å­˜
    useCORS: true,
    allowTaint: true,       // âœ… æŸ„ï¼ˆgradientï¼‰ã‚’ç¢ºå®Ÿã«æç”»
    imageTimeout: 0
  }).then(canvas => {

    // âœ… UIã‚’æˆ»ã™
    uiButtons.forEach(btn => btn.classList.remove("hide-ui"));

    // âœ… ä¿å­˜
    const link = document.createElement("a");
    link.download = "coordinate.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
  });
});

</script>

<script>
/* --- ã‚¸ãƒ£ãƒ³ãƒ«åˆ‡ã‚Šæ›¿ãˆ --- */
document.querySelectorAll(".genre-buttons button").forEach(btn => {
  btn.addEventListener("click", () => {
    const genre = btn.dataset.genre;

    document.querySelectorAll(".genre-items").forEach(g => g.style.display = "none");
    document.getElementById(genre).style.display = "block";
  });
});

/* --- å•†å“ã‚¯ãƒªãƒƒã‚¯ã§ã‚­ãƒ£ãƒ³ãƒã‚¹ã«é…ç½® --- */
document.querySelectorAll(".genre-items img").forEach(img => {
  img.addEventListener("click", () => {
    const slot = img.dataset.slot;
    placeItemInSlot(img.src, slot);
  });
});

/* --- ã‚­ãƒ£ãƒ³ãƒã‚¹ã«ã‚¢ã‚¤ãƒ†ãƒ ã‚’é…ç½®ï¼ˆå®Œæˆç‰ˆï¼‰ --- */
function placeItemInSlot(src, slot) {
  const area = document.getElementById("coordinate-area");

  // âœ… wrapperï¼ˆç”»åƒï¼‹å‰Šé™¤ï¼‹ãƒªã‚µã‚¤ã‚ºï¼‰
  const wrapper = document.createElement("div");
  wrapper.classList.add("placed-wrapper");
  wrapper.style.position = "absolute";
  wrapper.style.zIndex = "2000";

  // âœ… ç”»åƒ
  const img = document.createElement("img");
  img.src = src;
  img.classList.add("placed-item");
  img.style.position = "absolute";
  img.style.zIndex = "2001";
  img.style.width = slot === "bag" ? "150px" : "250px";

  // âœ… å‰Šé™¤ãƒœã‚¿ãƒ³ï¼ˆå·¦ä¸Šï¼‰
  const del = document.createElement("button");
  del.classList.add("delete-btn");
  del.textContent = "Ã—";
  del.style.zIndex = "2002";
  del.addEventListener("click", () => wrapper.remove());

  // âœ… ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«ï¼ˆå³ä¸‹ï¼‰
  const handle = document.createElement("div");
  handle.classList.add("resize-handle");
  handle.style.zIndex = "2002";
   handle.textContent = "â†–ï¸";   // â† ã“ã‚Œã‚’è¿½åŠ ï¼

  // âœ… wrapper ã«è¿½åŠ 
  wrapper.appendChild(img);
  wrapper.appendChild(del);
  wrapper.appendChild(handle);
  area.appendChild(wrapper);

  // âœ… åˆæœŸä½ç½®
  const positions = {
    top:   { left: "50%", top: "10%" },
    bottom:{ left: "50%", top: "60%" },
    bag:   { left: "80%", top: "40%" },
    accessories: {left: "60%", top: "40%" },
     shoes: {left: "40%", top: "80%" } 
  };

  const pos = positions[slot];
  wrapper.style.left = pos.left;
  wrapper.style.top = pos.top;
  wrapper.style.transform = "translate(-50%, -50%)";

  // âœ… æ©Ÿèƒ½ã‚’é©ç”¨
  enableDrag(wrapper);
  enableResize(wrapper, img, handle);
}

/* --- ãƒ‰ãƒ©ãƒƒã‚°æ©Ÿèƒ½ï¼ˆå®Œæˆç‰ˆï¼‰ --- */
function enableDrag(wrapper) {
  let isDragging = false;
  let offsetX = 0;
  let offsetY = 0;

  wrapper.addEventListener("mousedown", startDrag);
  wrapper.addEventListener("touchstart", startDrag);

  function startDrag(e) {
    e.preventDefault();
    isDragging = true;

    const rect = wrapper.getBoundingClientRect();
    const x = e.touches ? e.touches[0].clientX : e.clientX;
    const y = e.touches ? e.touches[0].clientY : e.clientY;

    offsetX = x - rect.left;
    offsetY = y - rect.top;

    document.addEventListener("mousemove", move);
    document.addEventListener("mouseup", endDrag);
    document.addEventListener("touchmove", move);
    document.addEventListener("touchend", endDrag);
  }

  function move(e) {
    if (!isDragging) return;

    const area = document.getElementById("coordinate-area");
    const rect = area.getBoundingClientRect();

    const x = e.touches ? e.touches[0].clientX : e.clientX;
    const y = e.touches ? e.touches[0].clientY : e.clientY;

    wrapper.style.left = (x - rect.left - offsetX) + "px";
    wrapper.style.top = (y - rect.top - offsetY) + "px";
    wrapper.style.transform = "none";
  }

  function endDrag() {
    isDragging = false;
    document.removeEventListener("mousemove", move);
    document.removeEventListener("mouseup", endDrag);
    document.removeEventListener("touchmove", move);
    document.removeEventListener("touchend", endDrag);
  }
}

/* --- ãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½ï¼ˆå®Œæˆç‰ˆï¼‰ --- */
function enableResize(wrapper, img, handle) {
  let startX, startY, startSize;

  handle.addEventListener("mousedown", startResize);
  handle.addEventListener("touchstart", startResize);

  function startResize(e) {
    e.preventDefault();

    startX = e.touches ? e.touches[0].clientX : e.clientX;
    startY = e.touches ? e.touches[0].clientY : e.clientY;

    // âœ… åŸºæº–ã‚µã‚¤ã‚ºï¼ˆå¹…ã‚’åŸºæº–ã«ã™ã‚‹ï¼‰
    startSize = img.offsetWidth;

    document.addEventListener("mousemove", resize);
    document.addEventListener("mouseup", stopResize);
    document.addEventListener("touchmove", resize);
    document.addEventListener("touchend", stopResize);
  }

  function resize(e) {
    const x = e.touches ? e.touches[0].clientX : e.clientX;
    const y = e.touches ? e.touches[0].clientY : e.clientY;

    // âœ… ãƒãƒ³ãƒ‰ãƒ«ã®ç§»å‹•è·é›¢ï¼ˆæ–œã‚æ–¹å‘ã‚‚å«ã‚€ï¼‰
    const diffX = x - startX;
    const diffY = y - startY;

    // âœ… æ–œã‚æ–¹å‘ã®è·é›¢ã‚’åˆæˆï¼ˆãƒ”ã‚¿ã‚´ãƒ©ã‚¹ï¼‰
    const distance = Math.sqrt(diffX * diffX + diffY * diffY);

    // âœ… ä¸Šæ–¹å‘ã«å‹•ã‹ã—ãŸã‚‰å¤§ããã€ä¸‹æ–¹å‘ãªã‚‰å°ã•ã
    const direction = diffY < 0 ? 1 : -1;

    // âœ… æ–°ã—ã„ã‚µã‚¤ã‚º
    const newSize = startSize + distance * direction;

    // âœ… æœ€å°ã‚µã‚¤ã‚ºã®åˆ¶é™
    if (newSize > 30) {
      img.style.width = newSize + "px";
      img.style.height = "auto"; // æ¯”ç‡ç¶­æŒ
    }
  }

  function stopResize() {
    document.removeEventListener("mousemove", resize);
    document.removeEventListener("mouseup", stopResize);
    document.removeEventListener("touchmove", resize);
    document.removeEventListener("touchend", stopResize);
  }
}





</script>








<!-- ä¿å­˜å‡¦ç† -->







</body>
</html>
